<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <title>DEV Test</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 32px; }
    #q { width: 360px; padding: 6px; }
    #b { padding: 6px 12px; margin-left: 6px; }
    #out {
      white-space: pre-wrap; background: #f3f4f6; padding: 10px;
      border-radius: 8px; margin-top: 12px; min-height: 60px;
    }
  </style>
</head>

<div style="margin-top:16px;font-size:12px;color:#6b7280;max-width:700px">
  ⚖️ <b>Дисклеймер:</b> Цей чат-бот надає довідкову інформацію з витягів
  офіційних документів (MiCA). Це <u>не</u> є індивідуальною юридичною порадою.
  Перевіряйте посилання на джерела та консультуйтеся з юристом у разі сумнівів.
</div>

<body>
  <h3>Тест локального AI-бота</h3>
  <input id="q" placeholder="Ваше питання">
  <button id="b">Запитати</button>
  <pre id="out"></pre>

  <script>
  (function(){
    function el(id){ return document.getElementById(id); }
    var btn = el('b'), inp = el('q'), out = el('out');

    btn.onclick = function(){
      var v = inp && inp.value ? String(inp.value).trim() : '';
      if(!v){ out.textContent = 'Введіть питання.'; return; }
      out.textContent = '⏳ Запит...';

      var xhr = new XMLHttpRequest();
      // АБСОЛЮТНА адреса бекенду на 8000 (щоб не було плутанини з портами)
      xhr.open('GET', 'http://127.0.0.1:8000/chat_get?q=' + encodeURIComponent(v), true);
      xhr.timeout = 15000;
      xhr.ontimeout = function(){ out.textContent = 'Перевищено час очікування.'; };
      xhr.onerror = function(){ out.textContent = 'Мережева помилка.'; };

      xhr.onreadystatechange = function(){
        if (xhr.readyState === 4) {
          if (xhr.status >= 200 && xhr.status < 300) {
            var t = xhr.responseText, shown = false;
            try {
              var j = JSON.parse(t);
              if (j && j.answer) { out.textContent = j.answer; shown = true; }
              else if (j && j.error) { out.textContent = j.error; shown = true; }
            } catch(e){}
            if (!shown) out.textContent = t || '(порожньо)';
          } else {
            out.textContent = 'HTTP ' + xhr.status + ' ' + (xhr.statusText||'');
          }
        }
      };
      xhr.send(null);
    };
  })();
  </script>
</body>
</html>